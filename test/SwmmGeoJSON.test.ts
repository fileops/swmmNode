// SwmmGeoJSON.test.ts
import { SwmmConvert, SwmmGeoJSON } from '../src/index'
import util from 'util'
import fs from 'fs'

let test_Example1 = './test/data/Example1.inp'
let test_file2 = './test/data/subareaRouting.inp'

// Prior to running tests, open files and set objects.
beforeAll(async () => {
  const readFile = util.promisify(fs.readFile)
  const file01 = await readFile(test_Example1, { encoding: 'utf8' });
  const file02 = await readFile(test_file2, { encoding: 'utf8' });

  (global as any).inp01 = SwmmConvert.parseInput(file01);
  (global as any).inp02 = SwmmConvert.parseInput(file02);
})


////////////////////////////////////////////////////////////////////////////////////////
// Object creation
////////////////////////////////////////////////////////////////////////////////////////

test('create a JSON object from an inp', () =>{
    expect((global as any).inp02).toBeDefined()
})

test('create a JSON object from an inp', () =>{
    expect(SwmmGeoJSON.geoJSON_model((global as any).inp02)).toBeDefined()
})

test('getBounds from an inp', () =>{
    expect(SwmmGeoJSON.getBounds((global as any).inp02)).toBeDefined()
})

test('create a JSON object from an inp', () =>{
    expect(SwmmGeoJSON.spatialProjection((global as any).inp02)).toBeDefined()/*({
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        134.65928726631492,
                        33.79934969702373
                    ]
                },
                "properties": {
                    "name": "Outfall1",
                    "layer": "OUTFALLS"
                }
            },
            {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        134.65962710256636,
                        33.79945432539196
                    ]
                },
                "properties": {
                    "name": "Outfall2",
                    "layer": "OUTFALLS"
                }
            },
            {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        134.65996693965207,
                        33.799558952827404
                    ]
                },
                "properties": {
                    "name": "Outfall3",
                    "layer": "OUTFALLS"
                }
            },
            {
                "type": "Feature",
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [
                            [
                                134.65909861579433,
                                33.799379515059115
                            ],
                            [
                                134.6594075577006,
                                33.7994746322674
                            ],
                            [
                                134.65892334096526,
                                33.80057080213852
                            ],
                            [
                                134.65861439567763,
                                33.80047568371344
                            ],
                            [
                                134.65909861579433,
                                33.799379515059115
                            ]
                        ]
                    ]
                },
                "properties": {
                    "name": "SubareaRouting",
                    "layer": "SUBCATCHMENTS"
                }
            },
            {
                "type": "Feature",
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [
                            [
                                134.65943845192916,
                                33.799484143945826
                            ],
                            [
                                134.65974739459384,
                                33.799579260306125
                            ],
                            [
                                134.65926318157804,
                                33.80067543151569
                            ],
                            [
                                134.65895423553195,
                                33.80058031393864
                            ],
                            [
                                134.65943845192916,
                                33.799484143945826
                            ]
                        ]
                    ]
                },
                "properties": {
                    "name": "DCIA",
                    "layer": "SUBCATCHMENTS"
                }
            },
            {
                "type": "Feature",
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [
                            [
                                134.6597782888982,
                                33.79958877189975
                            ],
                            [
                                134.66008723232125,
                                33.799683887412016
                            ],
                            [
                                134.6596030230251,
                                33.80078005996003
                            ],
                            [
                                134.6592940762206,
                                33.80068494323101
                            ],
                            [
                                134.6597782888982,
                                33.79958877189975
                            ]
                        ]
                    ]
                },
                "properties": {
                    "name": "IA",
                    "layer": "SUBCATCHMENTS"
                }
            }
        ]
    })*/
})

/*test('deprojection', () =>{
    expect(SwmmGeoJSON.deProjection((global as any).inp02, {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [
                            [
                                -68.93458887934685,
                                12.105451471096075
                            ],
                            [
                                -68.9345084130764,
                                12.10515905488218
                            ],
                            [
                                -68.9345271885395,
                                12.105142008187201
                            ],
                            [
                                -68.93452316522598,
                                12.105117093784884
                            ],
                            [
                                -68.93428176641464,
                                12.104900731772247
                            ],
                            [
                                -68.93426567316055,
                                12.104921712338722
                            ],
                            [
                                -68.9340028166771,
                                12.104766980622244
                            ],
                            [
                                -68.93413290381432,
                                12.104593890799322
                            ],
                            [
                                -68.93422946333885,
                                12.104630606831734
                            ],
                            [
                                -68.93433004617691,
                                12.104420800864261
                            ],
                            [
                                -68.93436625599861,
                                12.104342123583962
                            ],
                            [
                                -68.93437027931213,
                                12.104335567142911
                            ],
                            [
                                -68.9343823492527,
                                12.10430803008866
                            ],
                            [
                                -68.93432065844536,
                                12.104283115608553
                            ],
                            [
                                -68.93438637256622,
                                12.104005122304585
                            ],
                            [
                                -68.9344534277916,
                                12.10403134810035
                            ],
                            [
                                -68.93461033701897,
                                12.104092978710213
                            ],
                            [
                                -68.9346344769001,
                                12.104102157736008
                            ],
                            [
                                -68.93460094928741,
                                12.104171656063869
                            ],
                            [
                                -68.9351199567318,
                                12.104732887181143
                            ],
                            [
                                -68.93516823649406,
                                12.104786649913208
                            ],
                            [
                                -68.93519505858421,
                                12.104763046763892
                            ],
                            [
                                -68.93534526228905,
                                12.10493351390663
                            ],
                            [
                                -68.93533453345299,
                                12.10499776687837
                            ],
                            [
                                -68.93512532114983,
                                12.105076443965572
                            ],
                            [
                                -68.93506228923798,
                                12.105039727994424
                            ],
                            [
                                -68.93514007329941,
                                12.1049938330234
                            ],
                            [
                                -68.93512934446335,
                                12.104975475032774
                            ],
                            [
                                -68.93520846962929,
                                12.10493089133604
                            ],
                            [
                                -68.93517225980759,
                                12.104871883490645
                            ],
                            [
                                -68.93514409661293,
                                12.10488761891736
                            ],
                            [
                                -68.93510788679123,
                                12.104827299776616
                            ],
                            [
                                -68.9350850880146,
                                12.104839101348702
                            ],
                            [
                                -68.93511459231377,
                                12.104749933902255
                            ],
                            [
                                -68.93498852849007,
                                12.10461618267675
                            ],
                            [
                                -68.93488794565201,
                                12.104508657133195
                            ],
                            [
                                -68.93479943275452,
                                12.104412933137283
                            ],
                            [
                                -68.93478199839592,
                                12.10439588639467
                            ],
                            [
                                -68.93472164869308,
                                12.104331633278179
                            ],
                            [
                                -68.93462106585503,
                                12.104224107620112
                            ],
                            [
                                -68.93457278609276,
                                12.104171656063869
                            ],
                            [
                                -68.93459290266037,
                                12.104140185125203
                            ],
                            [
                                -68.93446683883667,
                                12.104083799684119
                            ],
                            [
                                -68.93435955047607,
                                12.104279181743067
                            ],
                            [
                                -68.93444001674652,
                                12.104314586530393
                            ],
                            [
                                -68.93426969647408,
                                12.104666011572505
                            ],
                            [
                                -68.93414095044136,
                                12.104613560103033
                            ],
                            [
                                -68.93406048417091,
                                12.104718463031674
                            ],
                            [
                                -68.93418118357658,
                                12.104787961199236
                            ],
                            [
                                -68.93415302038193,
                                12.104832544919816
                            ],
                            [
                                -68.93422946333885,
                                12.104874506061847
                            ],
                            [
                                -68.93425360321999,
                                12.104846969063146
                            ],
                            [
                                -68.93429920077324,
                                12.104882373775226
                            ],
                            [
                                -68.93447622656822,
                                12.105034482855274
                            ],
                            [
                                -68.93453255295753,
                                12.10508431167301
                            ],
                            [
                                -68.93461167812347,
                                12.105152498461166
                            ],
                            [
                                -68.9346519112587,
                                12.105186591848721
                            ],
                            [
                                -68.93462911248207,
                                12.105269202731264
                            ],
                            [
                                -68.9346519112587,
                                12.105275759149421
                            ],
                            [
                                -68.9347068965435,
                                12.10513151791281
                            ],
                            [
                                -68.93475651741028,
                                12.105212817528468
                            ],
                            [
                                -68.93479004502296,
                                12.105193148268896
                            ],
                            [
                                -68.93480345606804,
                                12.1052442883408
                            ],
                            [
                                -68.93458887934685,
                                12.105451471096075
                            ]
                        ]
                    ]
                },
                "properties": {
                    "name": "312133436",
                    "layer": "SUBCATCHMENTS"
                }
            },
            {
                "type": "Feature",
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [
                            [
                                -68.93475651741028,
                                12.105212817528468
                            ],
                            [
                                -68.9347068965435,
                                12.10513151791281
                            ],
                            [
                                -68.93478065729141,
                                12.10508955681118
                            ],
                            [
                                -68.93474847078323,
                                12.105035794140079
                            ],
                            [
                                -68.9350850880146,
                                12.104839101348702
                            ],
                            [
                                -68.93510788679123,
                                12.104827299776616
                            ],
                            [
                                -68.93514409661293,
                                12.10488761891736
                            ],
                            [
                                -68.93517225980759,
                                12.104871883490645
                            ],
                            [
                                -68.93520846962929,
                                12.10493089133604
                            ],
                            [
                                -68.93512934446335,
                                12.104975475032774
                            ],
                            [
                                -68.93514007329941,
                                12.1049938330234
                            ],
                            [
                                -68.93506228923798,
                                12.105039727994424
                            ],
                            [
                                -68.93499121069908,
                                12.105081689103883
                            ],
                            [
                                -68.93500059843063,
                                12.105096113233728
                            ],
                            [
                                -68.93491074442863,
                                12.105147253324233
                            ],
                            [
                                -68.93490001559258,
                                12.105128895344151
                            ],
                            [
                                -68.93479004502296,
                                12.105193148268896
                            ],
                            [
                                -68.93475651741028,
                                12.105212817528468
                            ]
                        ]
                    ]
                },
                "properties": {
                    "name": "194371585",
                    "layer": "SUBCATCHMENTS"
                }
            },
            {
                "type": "Feature",
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [
                            [
                                -68.93408328294754,
                                12.104571598920046
                            ],
                            [
                                -68.93394649028778,
                                12.104520458719364
                            ],
                            [
                                -68.93397063016891,
                                12.104454894345182
                            ],
                            [
                                -68.93409669399261,
                                12.104503411983629
                            ],
                            [
                                -68.93415570259094,
                                12.104353925177506
                            ],
                            [
                                -68.93402829766273,
                                12.104306718800288
                            ],
                            [
                                -68.93405377864838,
                                12.104241154373668
                            ],
                            [
                                -68.93419057130814,
                                12.104292294627811
                            ],
                            [
                                -68.93416911363602,
                                12.104347368736711
                            ],
                            [
                                -68.93423616886139,
                                12.104372283210822
                            ],
                            [
                                -68.93417045474052,
                                12.104541439315696
                            ],
                            [
                                -68.93410339951515,
                                12.10451652485736
                            ],
                            [
                                -68.93408328294754,
                                12.104571598920046
                            ]
                        ]
                    ]
                },
                "properties": {
                    "name": "312133422",
                    "layer": "SUBCATCHMENTS"
                }
            }
        ]
    })).toEqual('')
})*/